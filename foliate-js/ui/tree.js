const createSVGElement=e=>document.createElementNS("http://www.w3.org/2000/svg",e),createExpanderIcon=()=>{const e=createSVGElement("svg");e.setAttribute("viewBox","0 0 13 10"),e.setAttribute("width","13"),e.setAttribute("height","13");const t=createSVGElement("polygon");return t.setAttribute("points","2 1, 12 1, 7 9"),e.append(t),e},createTOCItemElement=(e,t,r)=>{let n=0;const a=({label:o,href:s,subitems:c},i=0)=>{const u=document.createElement(s?"a":"span");u.innerText=o,u.setAttribute("role","treeitem"),u.tabIndex=-1,u.style.paddingInlineStart=24*(i+1)+"px",e.push(u),s?(t.has(s)||t.set(s,u),u.href=s,u.onclick=e=>{e.preventDefault(),r(s)}):u.onclick=e=>u.firstElementChild?.onclick(e);const d=document.createElement("li");if(d.setAttribute("role","none"),d.append(u),c?.length){u.setAttribute("aria-expanded","false");const e=createExpanderIcon();e.onclick=e=>{e.preventDefault(),e.stopPropagation();const t=u.getAttribute("aria-expanded");u.setAttribute("aria-expanded","true"===t?"false":"true")},u.prepend(e);const t=document.createElement("ol");t.id="toc-element-"+n++,t.setAttribute("role","group"),u.setAttribute("aria-owns",t.id),t.replaceChildren(...c.map((e=>a(e,i+1)))),d.append(t)}return d};return a};export const createTOCView=(e,t)=>{const r=document.createElement("ol");r.setAttribute("role","tree");const n=[],a=new Map,o=createTOCItemElement(n,a,t);r.replaceChildren(...e.map((e=>o(e))));const s=e=>"treeitem"===e?.getAttribute("role"),c=function*(e){for(let t=e.parentNode;t!==r;t=t.parentNode){const e=t.previousElementSibling;s(e)&&(yield e)}};let i,u;r.addEventListener("focusout",(()=>{if(i)if(u&&(u.tabIndex=-1),i.offsetParent)i.tabIndex=0;else for(const e of c(i))if(e.offsetParent){e.tabIndex=0,u=e;break}}));const d=document.createTreeWalker(r,1,{acceptNode:e=>s(e)&&e.offsetParent?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}),l=e=>(d.currentNode=e,d);for(const e of n)e.addEventListener("keydown",(e=>{let t=!1;const{currentTarget:r,key:a}=e;switch(a){case" ":case"Enter":r.click(),t=!0;break;case"ArrowDown":l(r).nextNode()?.focus(),t=!0;break;case"ArrowUp":l(r).previousNode()?.focus(),t=!0;break;case"ArrowLeft":"true"===r.getAttribute("aria-expanded")?r.setAttribute("aria-expanded","false"):c(r).next()?.value?.focus(),t=!0;break;case"ArrowRight":"true"===r.getAttribute("aria-expanded")?l(r).nextNode()?.focus():r.getAttribute("aria-owns")&&r.setAttribute("aria-expanded","true"),t=!0;break;case"Home":n[0].focus(),t=!0;break;case"End":{const e=n[n.length-1];e.offsetParent?e.focus():l(e).previousNode()?.focus(),t=!0;break}}t&&(e.preventDefault(),e.stopPropagation())}));return{element:r,setCurrentHref:e=>{i&&(i.removeAttribute("aria-current"),i.tabIndex=-1);const t=a.get(e);if(!t)return i=n[0],void(i.tabIndex=0);for(const e of c(t))e.setAttribute("aria-expanded","true");t.setAttribute("aria-current","page"),t.tabIndex=0,t.scrollIntoView({behavior:"smooth",block:"center"}),i=t}}};