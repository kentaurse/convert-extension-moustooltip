export class Color{constructor(...t){if(Array.isArray(t[0])){const[r,s]=t;"lab"===s?this._lab=r:this._rgb=r}else if("string"==typeof t[0]){const r=t[0];if("#"===r[0]&&7===r.length)this._hex=r,this._rgb=Color.parseHex(r);else if(r.startsWith("rgb("))this._rgb=Color.parseRGB(r);else{if(!r.startsWith("rgba("))return console.error(`Unsupported color format: "${r}"`),null;[this._rgb,this._alpha]=Color.parseRGBA(r)}}else this._rgb=[0,0,0]}get hex(){return this._hex=this._hex||this.toHex(),this._hex}get rgb(){return this._rgb=this._rgb||sRGB.fromLab(this._lab),this._rgb}get lab(){return this._lab=this._lab||sRGB.toLab(this._rgb),this._lab}get lightness(){return this.lab[0]}get chroma(){const[t,r,s]=this.lab;return Math.sqrt(r**2+s**2)}get alpha(){return this._alpha??1}deltaE(t){return Math.sqrt(this.lab.reduce(((r,s,a)=>isNaN(s)||isNaN(t.lab[a])?r:r+(t.lab[a]-s)**2),0))}range(t){return r=>{const s=this.lab.map(((s,a)=>function(t,r,s){return isNaN(t)?r:isNaN(r)?t:t+(r-t)*s}(s,t.lab[a],r)));return new Color(s,"lab")}}toHex(t=1){let r=this.rgb.map(Color.compToHex).join("");return 1!==t&&(r+=Color.compToHex(t)),"#"+r}static parseHex(t){let r=[];return t.replace(/[a-f0-9]{2}/gi,(t=>{r.push(parseInt(t,16)/255)})),r.slice(0,3)}static parseRGB(t){return Color.parseRGBA(t.replace("rgb","rgba"))[0]}static parseRGBA(t){const r=t.slice(5,-1).split(",");return[r.slice(0,3).map((t=>parseInt(t)/255)),parseFloat(r.pop())]}static compToHex(t){return(t=Math.round(Math.min(Math.max(255*t,0),255))).toString(16).padStart(2,"0")}}Color.white=new Color([1,1,1]);const Matrices={lin_sRGB_to_XYZ:[[.41239079926595934,.357584339383878,.1804807884018343],[.21263900587151027,.715168678767756,.07219231536073371],[.01933081871559182,.11919477979462598,.9505321522496607]],XYZ_to_lin_sRGB:[[3.2409699419045226,-1.537383177570094,-.4986107602930034],[-.9692436362808796,1.8759675015077202,.04155505740717559],[.05563007969699366,-.20397695888897652,1.0569715142428786]],D65_to_D50:[[1.0479298208405488,.022946793341019088,-.05019222954313557],[.029627815688159344,.990434484573249,-.01707382502938514],[-.009243058152591178,.015055144896577895,.7518742899580008]],D50_to_D65:[[.9554734527042182,-.023098536874261423,.0632593086610217],[-.028369706963208136,1.0099954580058226,.021041398966943008],[.012314001688319899,-.020507696433477912,1.3303659366080753]],multiply(t,r){const s=t.length;Array.isArray(t[0])||(t=[t]),Array.isArray(r[0])||(r=r.map((t=>[t])));const a=r[0].length,e=r[0].map(((t,s)=>r.map((t=>t[s]))));let i=t.map((t=>e.map((r=>Array.isArray(t)?t.reduce(((t,s,a)=>t+s*(r[a]||0)),0):r.reduce(((r,s)=>r+s*t),0)))));return 1===s&&(i=i[0]),1===a?i.map((t=>t[0])):i}},sRGB={toXYZ_M:Matrices.multiply(Matrices.D65_to_D50,Matrices.lin_sRGB_to_XYZ),fromXYZ_M:Matrices.multiply(Matrices.XYZ_to_lin_sRGB,Matrices.D50_to_D65),whites:{D50:[.3457/.3585,1,.2958/.3585]},CIE_fracs:{ε:216/24389,ε3:24/116,κ:24389/27},toLab(t){return this.XYZtoLab(this.toXYZ(this.toLinear(t)))},toLinear:t=>t.map((function(t){const r=t<0?-1:1,s=Math.abs(t);return s<.04045?t/12.92:r*Math.pow((s+.055)/1.055,2.4)})),toXYZ(t){return Matrices.multiply(this.toXYZ_M,t)},XYZtoLab(t){const r=this.whites.D50,{κ:s,ε:a}=this.CIE_fracs,e=t.map(((t,s)=>t/r[s])).map((t=>t>a?Math.cbrt(t):(s*t+16)/116));return[116*e[1]-16,500*(e[0]-e[1]),200*(e[1]-e[2])]},fromLab(t){return this.toGamma(this.fromXYZ(this.LabToXYZ(t)))},LabToXYZ(t){const r=this.whites.D50,{κ:s,ε3:a}=this.CIE_fracs;let e=[];return e[1]=(t[0]+16)/116,e[0]=t[1]/500+e[1],e[2]=e[1]-t[2]/200,[e[0]>a?Math.pow(e[0],3):(116*e[0]-16)/s,t[0]>8?Math.pow((t[0]+16)/116,3):t[0]/s,e[2]>a?Math.pow(e[2],3):(116*e[2]-16)/s].map(((t,s)=>t*r[s]))},fromXYZ(t){return Matrices.multiply(this.fromXYZ_M,t)},toGamma:t=>t.map((function(t){const r=t<0?-1:1,s=Math.abs(t);return s>.0031308?r*(1.055*Math.pow(s,1/2.4)-.055):12.92*t}))};