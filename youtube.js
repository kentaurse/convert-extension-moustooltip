(()=>{"use strict";var e=new TextEncoder,t=new Set([101,103,204,205,304]),s=/(%?)(%([sdjo]))/g;function r(e,...t){if(0===t.length)return e;let r=0,n=e.replace(s,((e,s,n,i)=>{const o=function(e,t){switch(t){case"s":return e;case"d":case"i":return Number(e);case"j":return JSON.stringify(e);case"o":{if("string"==typeof e)return e;const t=JSON.stringify(e);return"{}"===t||"[]"===t||/^\[object .+?\]$/.test(t)?e:t}}}(t[r],i);return s?e:(r++,o)}));return r<t.length&&(n+=` ${t.slice(r).join(" ")}`),n=n.replace(/%{2,2}/g,"%"),n}var n=class extends Error{constructor(e,...t){super(e),this.message=e,this.name="Invariant Violation",this.message=r(e,...t),function(e){if(!e.stack)return;const t=e.stack.split("\n");t.splice(1,2),e.stack=t.join("\n")}(this)}},i=(e,t,...s)=>{if(!e)throw new n(t,...s)};i.as=(e,t,s,...n)=>{if(!t)throw null!=e.prototype.name?new e(r(s,n)):e(r(s,n))};var o=class extends Promise{#e;resolve;reject;constructor(e=null){const t=function(){const e=(t,s)=>{e.state="pending",e.resolve=s=>{if("pending"===e.state)return e.result=s,t(s instanceof Promise?s:Promise.resolve(s).then((t=>(e.state="fulfilled",t))))},e.reject=t=>{if("pending"===e.state)return queueMicrotask((()=>{e.state="rejected"})),s(e.rejectionReason=t)}};return e}();super(((s,r)=>{t(s,r),e?.(t.resolve,t.reject)})),this.#e=t,this.resolve=this.#e.resolve,this.reject=this.#e.reject}get state(){return this.#e.state}get rejectionReason(){return this.#e.rejectionReason}then(e,t){return this.#t(super.then(e,t))}catch(e){return this.#t(super.catch(e))}finally(e){return this.#t(super.finally(e))}#t(e){return Object.defineProperties(e,{resolve:{configurable:!0,value:this.resolve},reject:{configurable:!0,value:this.reject}})}};function a(){if("undefined"!=typeof navigator&&"ReactNative"===navigator.product)return!0;if("undefined"!=typeof process){const e=process.type;return"renderer"!==e&&"worker"!==e&&!(!process.versions||!process.versions.node)}return!1}var u=Object.defineProperty,l={};function c(e){return`[33m${e}[0m`}function h(e){return`[34m${e}[0m`}function d(e){return`[90m${e}[0m`}function p(e){return`[31m${e}[0m`}function g(e){return`[32m${e}[0m`}((e,t)=>{for(var s in t)u(e,s,{get:t[s],enumerable:!0})})(l,{blue:()=>h,gray:()=>d,green:()=>g,red:()=>p,yellow:()=>c});var f=a(),m=class{constructor(e){this.name=e,this.prefix=`[${this.name}]`;const t=x("DEBUG"),s=x("LOG_LEVEL");"1"===t||"true"===t||void 0!==t&&this.name.startsWith(t)?(this.debug=L(s,"debug")?v:this.debug,this.info=L(s,"info")?v:this.info,this.success=L(s,"success")?v:this.success,this.warning=L(s,"warning")?v:this.warning,this.error=L(s,"error")?v:this.error):(this.info=v,this.success=v,this.warning=v,this.error=v,this.only=v)}prefix;extend(e){return new m(`${this.name}:${e}`)}debug(e,...t){this.logEntry({level:"debug",message:d(e),positionals:t,prefix:this.prefix,colors:{prefix:"gray"}})}info(e,...t){this.logEntry({level:"info",message:e,positionals:t,prefix:this.prefix,colors:{prefix:"blue"}});const s=new y;return(e,...t)=>{s.measure(),this.logEntry({level:"info",message:`${e} ${d(`${s.deltaTime}ms`)}`,positionals:t,prefix:this.prefix,colors:{prefix:"blue"}})}}success(e,...t){this.logEntry({level:"info",message:e,positionals:t,prefix:`âœ” ${this.prefix}`,colors:{timestamp:"green",prefix:"green"}})}warning(e,...t){this.logEntry({level:"warning",message:e,positionals:t,prefix:`âš  ${this.prefix}`,colors:{timestamp:"yellow",prefix:"yellow"}})}error(e,...t){this.logEntry({level:"error",message:e,positionals:t,prefix:`âœ– ${this.prefix}`,colors:{timestamp:"red",prefix:"red"}})}only(e){e()}createEntry(e,t){return{timestamp:new Date,level:e,message:t}}logEntry(e){const{level:t,message:s,prefix:r,colors:n,positionals:i=[]}=e,o=this.createEntry(t,s),a={timestamp:l[n?.timestamp||"gray"],prefix:l[n?.prefix||"gray"]};this.getWriter(t)([a.timestamp(this.formatTimestamp(o.timestamp))].concat(null!=r?a.prefix(r):[]).concat(T(s)).join(" "),...i.map(T))}formatTimestamp(e){return`${e.toLocaleTimeString("en-GB")}:${e.getMilliseconds()}`}getWriter(e){switch(e){case"debug":case"success":case"info":return b;case"warning":return w;case"error":return q}}},y=class{startTime;endTime;deltaTime;constructor(){this.startTime=performance.now()}measure(){this.endTime=performance.now();const e=this.endTime-this.startTime;this.deltaTime=e.toFixed(2)}},v=()=>{};function b(e,...t){f?process.stdout.write(r(e,...t)+"\n"):console.log(e,...t)}function w(e,...t){f?process.stderr.write(r(e,...t)+"\n"):console.warn(e,...t)}function q(e,...t){f?process.stderr.write(r(e,...t)+"\n"):console.error(e,...t)}function x(e){return f?process.env[e]:globalThis[e]?.toString()}function L(e,t){return void 0!==e&&e!==t}function T(e){return void 0===e?"undefined":null===e?"null":"string"==typeof e?e:"object"==typeof e?JSON.stringify(e):e.toString()}var R=class extends Error{constructor(e,t,s){super(`Possible EventEmitter memory leak detected. ${s} ${t.toString()} listeners added. Use emitter.setMaxListeners() to increase limit`),this.emitter=e,this.type=t,this.count=s,this.name="MaxListenersExceededWarning"}},E=class{static listenerCount(e,t){return e.listenerCount(t)}constructor(){this.events=new Map,this.maxListeners=E.defaultMaxListeners,this.hasWarnedAboutPotentialMemoryLeak=!1}_emitInternalEvent(e,t,s){this.emit(e,t,s)}_getListeners(e){return Array.prototype.concat.apply([],this.events.get(e))||[]}_removeListener(e,t){const s=e.indexOf(t);return s>-1&&e.splice(s,1),[]}_wrapOnceListener(e,t){const s=(...r)=>(this.removeListener(e,s),t.apply(this,r));return Object.defineProperty(s,"name",{value:t.name}),s}setMaxListeners(e){return this.maxListeners=e,this}getMaxListeners(){return this.maxListeners}eventNames(){return Array.from(this.events.keys())}emit(e,...t){const s=this._getListeners(e);return s.forEach((e=>{e.apply(this,t)})),s.length>0}addListener(e,t){this._emitInternalEvent("newListener",e,t);const s=this._getListeners(e).concat(t);if(this.events.set(e,s),this.maxListeners>0&&this.listenerCount(e)>this.maxListeners&&!this.hasWarnedAboutPotentialMemoryLeak){this.hasWarnedAboutPotentialMemoryLeak=!0;const t=new R(this,e,this.listenerCount(e));console.warn(t)}return this}on(e,t){return this.addListener(e,t)}once(e,t){return this.addListener(e,this._wrapOnceListener(e,t))}prependListener(e,t){const s=this._getListeners(e);if(s.length>0){const r=[t].concat(s);this.events.set(e,r)}else this.events.set(e,s.concat(t));return this}prependOnceListener(e,t){return this.prependListener(e,this._wrapOnceListener(e,t))}removeListener(e,t){const s=this._getListeners(e);return s.length>0&&(this._removeListener(s,t),this.events.set(e,s),this._emitInternalEvent("removeListener",e,t)),this}off(e,t){return this.removeListener(e,t)}removeAllListeners(e){return e?this.events.delete(e):this.events.clear(),this}listeners(e){return Array.from(this._getListeners(e))}listenerCount(e){return this._getListeners(e).length}rawListeners(e){return this.listeners(e)}},S=E;S.defaultMaxListeners=10;var P=Symbol("isPatchedModule");function M(e){return globalThis[e]||void 0}var I=class{constructor(e){this.symbol=e,this.readyState="INACTIVE",this.emitter=new S,this.subscriptions=[],this.logger=new m(e.description),this.emitter.setMaxListeners(0),this.logger.info("constructing the interceptor...")}checkEnvironment(){return!0}apply(){const e=this.logger.extend("apply");if(e.info("applying the interceptor..."),"APPLIED"===this.readyState)return void e.info("intercepted already applied!");if(!this.checkEnvironment())return void e.info("the interceptor cannot be applied in this environment!");this.readyState="APPLYING";const t=this.getInstance();if(t)return e.info("found a running instance, reusing..."),this.on=(s,r)=>(e.info('proxying the "%s" listener',s),t.emitter.addListener(s,r),this.subscriptions.push((()=>{t.emitter.removeListener(s,r),e.info('removed proxied "%s" listener!',s)})),this),void(this.readyState="APPLIED");e.info("no running instance found, setting up a new instance..."),this.setup(),this.setInstance(),this.readyState="APPLIED"}setup(){}on(e,t){const s=this.logger.extend("on");return"DISPOSING"===this.readyState||"DISPOSED"===this.readyState?(s.info("cannot listen to events, already disposed!"),this):(s.info('adding "%s" event listener:',e,t),this.emitter.on(e,t),this)}once(e,t){return this.emitter.once(e,t),this}off(e,t){return this.emitter.off(e,t),this}removeAllListeners(e){return this.emitter.removeAllListeners(e),this}dispose(){const e=this.logger.extend("dispose");if("DISPOSED"!==this.readyState)if(e.info("disposing the interceptor..."),this.readyState="DISPOSING",this.getInstance()){if(this.clearInstance(),e.info("global symbol deleted:",M(this.symbol)),this.subscriptions.length>0){e.info("disposing of %d subscriptions...",this.subscriptions.length);for(const e of this.subscriptions)e();this.subscriptions=[],e.info("disposed of all subscriptions!",this.subscriptions.length)}this.emitter.removeAllListeners(),e.info("destroyed the listener!"),this.readyState="DISPOSED"}else e.info("no interceptors running, skipping dispose...");else e.info("cannot dispose, already disposed!")}getInstance(){var e;const t=M(this.symbol);return this.logger.info("retrieved global instance:",null==(e=null==t?void 0:t.constructor)?void 0:e.name),t}setInstance(){var e;e=this.symbol,globalThis[e]=this,this.logger.info("set global instance!",this.symbol.description)}clearInstance(){var e;e=this.symbol,delete globalThis[e],this.logger.info("cleared global instance!",this.symbol.description)}},O=class{constructor(e,t){this.AT_TARGET=0,this.BUBBLING_PHASE=0,this.CAPTURING_PHASE=0,this.NONE=0,this.type="",this.srcElement=null,this.currentTarget=null,this.eventPhase=0,this.isTrusted=!0,this.composed=!1,this.cancelable=!0,this.defaultPrevented=!1,this.bubbles=!0,this.lengthComputable=!0,this.loaded=0,this.total=0,this.cancelBubble=!1,this.returnValue=!0,this.type=e,this.target=(null==t?void 0:t.target)||null,this.currentTarget=(null==t?void 0:t.currentTarget)||null,this.timeStamp=Date.now()}composedPath(){return[]}initEvent(e,t,s){this.type=e,this.bubbles=!!t,this.cancelable=!!s}preventDefault(){this.defaultPrevented=!0}stopPropagation(){}stopImmediatePropagation(){}},A=class extends O{constructor(e,t){super(e),this.lengthComputable=(null==t?void 0:t.lengthComputable)||!1,this.composed=(null==t?void 0:t.composed)||!1,this.loaded=(null==t?void 0:t.loaded)||0,this.total=(null==t?void 0:t.total)||0}},D="undefined"!=typeof ProgressEvent;function k(e,t){if(!(t in e))return null;if(Object.prototype.hasOwnProperty.call(e,t))return e;const s=Reflect.getPrototypeOf(e);return s?k(s,t):null}function H(e,t){const s=new Proxy(e,function(e){const{constructorCall:t,methodCall:s,getProperty:r,setProperty:n}=e,i={};return void 0!==t&&(i.construct=function(e,s,r){const n=Reflect.construct.bind(null,e,s,r);return t.call(r,s,n)}),i.set=function(e,t,s){const r=()=>{const r=k(e,t)||e,n=Reflect.getOwnPropertyDescriptor(r,t);return void 0!==(null==n?void 0:n.set)?(n.set.apply(e,[s]),!0):Reflect.defineProperty(r,t,{writable:!0,enumerable:!0,configurable:!0,value:s})};return void 0!==n?n.call(e,[t,s],r):r()},i.get=function(e,t,n){const i=()=>e[t],o=void 0!==r?r.call(e,[t,n],i):i();return"function"==typeof o?(...r)=>{const n=o.bind(e,...r);return void 0!==s?s.call(e,[t,r],n):n()}:o},i}(t));return s}function C(e){const t=new Headers,s=e.split(/[\r\n]+/);for(const e of s){if(""===e.trim())continue;const[s,...r]=e.split(": "),n=r.join(": ");t.append(s,n)}return t}var j=Symbol("isMockedResponse"),N=a();function $(e){return"undefined"==typeof location?new URL(e):new URL(e.toString(),location.href)}function B(e,t,s){Reflect.defineProperty(e,t,{writable:!0,enumerable:!0,value:s})}function _({emitter:s,logger:r}){const n=new Proxy(globalThis.XMLHttpRequest,{construct(n,a,u){r.info("constructed new XMLHttpRequest");const l=Reflect.construct(n,a,u),c=Object.getOwnPropertyDescriptors(n.prototype);for(const e in c)Reflect.defineProperty(l,e,c[e]);const h=new class{constructor(s,r){this.initialRequest=s,this.logger=r,this.method="GET",this.url=null,this.events=new Map,this.requestId="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})),this.requestHeaders=new Headers,this.responseBuffer=new Uint8Array,this.request=H(s,{setProperty:([e,t],s)=>{if("ontimeout"===e){const r=e.slice(2);return this.request.addEventListener(r,t),s()}return s()},methodCall:([s,r],n)=>{var i,o;switch(s){case"open":{const[e,t]=r;return void 0===t?(this.method="GET",this.url=$(e)):(this.method=e,this.url=$(t)),this.logger=this.logger.extend(`${this.method} ${this.url.href}`),this.logger.info("open",this.method,this.url.href),n()}case"addEventListener":{const[e,t]=r;return this.registerEvent(e,t),this.logger.info("addEventListener",e,t),n()}case"setRequestHeader":{const[e,t]=r;return this.requestHeaders.set(e,t),this.logger.info("setRequestHeader",e,t),n()}case"send":{const[s]=r;null!=s&&(this.requestBody="string"==typeof s?(o=s,e.encode(o)):s),this.request.addEventListener("load",(()=>{if(void 0!==this.onResponse){const e=function(e,s){const r=(n=e.status,t.has(n)?null:s);var n;return new Response(r,{status:e.status,statusText:e.statusText,headers:C(e.getAllResponseHeaders())})}(this.request,this.request.response);this.onResponse.call(this,{response:e,isMockedResponse:j in this.request,request:a,requestId:this.requestId})}}));const a=this.toFetchApiRequest();((null==(i=this.onRequest)?void 0:i.call(this,{request:a,requestId:this.requestId}))||Promise.resolve()).finally((()=>{if(this.request.readyState<this.request.LOADING)return this.logger.info("request callback settled but request has not been handled (readystate %d), performing as-is...",this.request.readyState),N&&this.request.setRequestHeader("X-Request-Id",this.requestId),n()}));break}default:return n()}}})}registerEvent(e,t){const s=(this.events.get(e)||[]).concat(t);this.events.set(e,s),this.logger.info('registered event "%s"',e,t)}respondWith(e){this.logger.info("responding with a mocked response: %d %s",e.status,e.statusText),B(this.request,j,!0),B(this.request,"status",e.status),B(this.request,"statusText",e.statusText),B(this.request,"responseURL",this.url.href),this.request.getResponseHeader=new Proxy(this.request.getResponseHeader,{apply:(t,s,r)=>{if(this.logger.info("getResponseHeader",r[0]),this.request.readyState<this.request.HEADERS_RECEIVED)return this.logger.info("headers not received yet, returning null"),null;const n=e.headers.get(r[0]);return this.logger.info('resolved response header "%s" to',r[0],n),n}}),this.request.getAllResponseHeaders=new Proxy(this.request.getAllResponseHeaders,{apply:()=>{if(this.logger.info("getAllResponseHeaders"),this.request.readyState<this.request.HEADERS_RECEIVED)return this.logger.info("headers not received yet, returning empty string"),"";const t=Array.from(e.headers.entries()).map((([e,t])=>`${e}: ${t}`)).join("\r\n");return this.logger.info("resolved all response headers to",t),t}}),Object.defineProperties(this.request,{response:{enumerable:!0,configurable:!1,get:()=>this.response},responseText:{enumerable:!0,configurable:!1,get:()=>this.responseText},responseXML:{enumerable:!0,configurable:!1,get:()=>this.responseXML}});const t=e.headers.has("Content-Length")?Number(e.headers.get("Content-Length")):void 0;this.logger.info("calculated response body length",t),this.trigger("loadstart",{loaded:0,total:t}),this.setReadyState(this.request.HEADERS_RECEIVED),this.setReadyState(this.request.LOADING);const s=()=>{this.logger.info("finalizing the mocked response..."),this.setReadyState(this.request.DONE),this.trigger("load",{loaded:this.responseBuffer.byteLength,total:t}),this.trigger("loadend",{loaded:this.responseBuffer.byteLength,total:t})};if(e.body){this.logger.info("mocked response has body, streaming...");const r=e.body.getReader(),n=async()=>{const{value:e,done:i}=await r.read();if(i)return this.logger.info("response body stream done!"),void s();e&&(this.logger.info("read response body chunk:",e),this.responseBuffer=function(e,t){const s=new Uint8Array(e.byteLength+t.byteLength);return s.set(e,0),s.set(t,e.byteLength),s}(this.responseBuffer,e),this.trigger("progress",{loaded:this.responseBuffer.byteLength,total:t})),n()};n()}else s()}responseBufferToText(){return e=this.responseBuffer,new TextDecoder(undefined).decode(e);var e}get response(){if(this.logger.info("getResponse (responseType: %s)",this.request.responseType),this.request.readyState!==this.request.DONE)return null;switch(this.request.responseType){case"json":{const e=function(e){try{return JSON.parse(e)}catch(e){return null}}(this.responseBufferToText());return this.logger.info("resolved response JSON",e),e}case"arraybuffer":{const t=(e=this.responseBuffer).buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);return this.logger.info("resolved response ArrayBuffer",t),t}case"blob":{const e=this.request.getResponseHeader("Content-Type")||"text/plain",t=new Blob([this.responseBufferToText()],{type:e});return this.logger.info("resolved response Blob (mime type: %s)",t,e),t}default:{const e=this.responseBufferToText();return this.logger.info('resolving "%s" response type as text',this.request.responseType,e),e}}var e}get responseText(){if(i(""===this.request.responseType||"text"===this.request.responseType,"InvalidStateError: The object is in invalid state."),this.request.readyState!==this.request.LOADING&&this.request.readyState!==this.request.DONE)return"";const e=this.responseBufferToText();return this.logger.info('getResponseText: "%s"',e),e}get responseXML(){if(i(""===this.request.responseType||"document"===this.request.responseType,"InvalidStateError: The object is in invalid state."),this.request.readyState!==this.request.DONE)return null;const e=this.request.getResponseHeader("Content-Type")||"";return"undefined"==typeof DOMParser?(console.warn("Cannot retrieve XMLHttpRequest response body as XML: DOMParser is not defined. You are likely using an environment that is not browser or does not polyfill browser globals correctly."),null):(t=e,["application/xhtml+xml","application/xml","image/svg+xml","text/html","text/xml"].some((e=>t.startsWith(e)))?(new DOMParser).parseFromString(this.responseBufferToText(),e):null);var t}errorWith(e){this.logger.info("responding with an error"),this.setReadyState(this.request.DONE),this.trigger("error"),this.trigger("loadend")}setReadyState(e){this.logger.info("setReadyState: %d -> %d",this.request.readyState,e),this.request.readyState!==e?(B(this.request,"readyState",e),this.logger.info("set readyState to: %d",e),e!==this.request.UNSENT&&(this.logger.info('triggerring "readystatechange" event...'),this.trigger("readystatechange"))):this.logger.info("ready state identical, skipping transition...")}trigger(e,t){const s=this.request[`on${e}`],r=function(e,t,s){const r=D?ProgressEvent:A;return["error","progress","loadstart","loadend","load","timeout","abort"].includes(t)?new r(t,{lengthComputable:!0,loaded:(null==s?void 0:s.loaded)||0,total:(null==s?void 0:s.total)||0}):new O(t,{target:e,currentTarget:e})}(this.request,e,t);this.logger.info('trigger "%s"',e,t||""),"function"==typeof s&&(this.logger.info('found a direct "%s" callback, calling...',e),s.call(this.request,r));for(const[t,s]of this.events)t===e&&(this.logger.info('found %d listener(s) for "%s" event, calling...',s.length,e),s.forEach((e=>e.call(this.request,r))))}toFetchApiRequest(){this.logger.info("converting request to a Fetch API Request...");const e=new Request(this.url.href,{method:this.method,headers:this.requestHeaders,credentials:this.request.withCredentials?"include":"same-origin",body:["GET","HEAD"].includes(this.method)?null:this.requestBody}),t=H(e.headers,{methodCall:([t,s],r)=>{switch(t){case"append":case"set":{const[e,t]=s;this.request.setRequestHeader(e,t);break}case"delete":{const[t]=s;console.warn(`XMLHttpRequest: Cannot remove a "${t}" header from the Fetch API representation of the "${e.method} ${e.url}" request. XMLHttpRequest headers cannot be removed.`);break}}return r()}});return B(e,"headers",t),this.logger.info("converted request to a Fetch API Request!",e),e}}(l,r);return h.onRequest=async function({request:e,requestId:t}){const{interactiveRequest:r,requestController:n}=function(e){const t=new class{constructor(e){this.request=e,this.responsePromise=new o}respondWith(e){i("pending"===this.responsePromise.state,'Failed to respond to "%s %s" request: the "request" event has already been responded to.',this.request.method,this.request.url),this.responsePromise.resolve(e)}}(e);return Reflect.set(e,"respondWith",t.respondWith.bind(t)),{interactiveRequest:e,requestController:t}}(e);this.logger.info("awaiting mocked response..."),s.once("request",(({requestId:e})=>{e===t&&"pending"===n.responsePromise.state&&n.respondWith(void 0)}));const a=await(async e=>{try{const t=await e().catch((e=>{throw e}));return{error:null,data:t}}catch(e){return{error:e,data:null}}})((async()=>{this.logger.info('emitting the "request" event for %s listener(s)...',s.listenerCount("request")),await async function(e,t,...s){const r=e.listeners(t);if(0!==r.length)for(const t of r)await t.apply(e,s)}(s,"request",{request:r,requestId:t}),this.logger.info('all "request" listeners settled!');const e=await n.responsePromise;return this.logger.info("event.respondWith called with:",e),e}));if(a.error)return this.logger.info("request listener threw an exception, aborting request...",a.error),void h.errorWith(a.error);const u=a.data;if(void 0!==u)return this.logger.info("received mocked response: %d %s",u.status,u.statusText),"error"===u.type?(this.logger.info("received a network error response, rejecting the request promise..."),void h.errorWith(new TypeError("Network error"))):h.respondWith(u);this.logger.info("no mocked response received, performing request as-is...")},h.onResponse=async function({response:e,isMockedResponse:t,request:r,requestId:n}){this.logger.info('emitting the "response" event for %s listener(s)...',s.listenerCount("response")),s.emit("response",{response:e,isMockedResponse:t,request:r,requestId:n})},h.request}});return n}var W=class extends I{constructor(){super(W.interceptorSymbol)}checkEnvironment(){return void 0!==globalThis.XMLHttpRequest}setup(){const e=this.logger.extend("setup");e.info('patching "XMLHttpRequest" module...');const t=globalThis.XMLHttpRequest;i(!t[P],'Failed to patch the "XMLHttpRequest" module: already patched.'),globalThis.XMLHttpRequest=_({emitter:this.emitter,logger:this.logger}),e.info('native "XMLHttpRequest" module patched!',globalThis.XMLHttpRequest.name),Object.defineProperty(globalThis.XMLHttpRequest,P,{enumerable:!0,configurable:!0,value:!0}),this.subscriptions.push((()=>{Object.defineProperty(globalThis.XMLHttpRequest,P,{value:void 0}),globalThis.XMLHttpRequest=t,e.info('native "XMLHttpRequest" module restored!',globalThis.XMLHttpRequest.name)}))}},X=W;X.interceptorSymbol=Symbol("xhr");class G extends Error{constructor(e){super(null!=e?`Timed out after waiting for ${e} ms`:"Timed out"),Object.setPrototypeOf(this,G.prototype)}}const U=(e,t)=>new Promise(((s,r)=>{try{e.schedule(s,t)}catch(e){r(e)}})),F={schedule:(e,t)=>{let s;const r=e=>{null!=e&&clearTimeout(e),s=void 0};return s=setTimeout((()=>{r(s),e()}),t),{cancel:()=>r(s)}}},V=Number.POSITIVE_INFINITY,J=()=>{const e=new Error("Delay aborted");return e.name="AbortError",e},Y=new WeakMap,z=function({clearTimeout:e,setTimeout:t}={}){return(s,{value:r,signal:n}={})=>{if(n?.aborted)return Promise.reject(J());let i,o,a;const u=e??clearTimeout,l=()=>{u(i),a(J())},c=new Promise(((e,u)=>{o=()=>{n&&n.removeEventListener("abort",l),e(r)},a=u,i=(t??setTimeout)(o,s)}));return n&&n.addEventListener("abort",l,{once:!0}),Y.set(c,(()=>{u(i),i=null,o()})),c}}(),K=new X;var Q=!1,Z="",ee="",te=0,se=!1,re=!1,ne=!1,ie="true",oe=!1,ae="";async function ue(){ce((e=>{"true"!=e.getAttribute("listener")&&(e.setAttribute("listener","true"),e.addEventListener("onStateChange",(e=>{-1==e&&(le(),he()),re=2==e})))}))}function le(){1!=Q&&(Q=!0,K.apply(),K.on("request",(async({request:e,requestId:t})=>{try{if(e.url.includes("www.youtube.com/api/timedtext")&&ae==fe(e.url)){var s=await be(e.url),r=pe(r=await s.json()),n=me(e.url,"lang"),i=r;if(n!=Z&&"dualsub"==ee){await z(te);var o=await async function(e,t){var s=fe(e),r=await async function(e,t){var s=await ge(e),r=s?.captions?.playerCaptionsTracklistRenderer?.captionTracks,n=r.filter((e=>!e?.kind&&e.languageCode==t))?.[0]?.baseUrl;return n?n+"&fmt=json3":""}(s,t);return r||(r=new URL(e)).searchParams.set("tlang",t),await(await be(r.toString())).json()}(e.url,Z),a=function(e,t){e=pe(e),t=pe(t);for(let[n,i]of e.events.entries()){var s=i.segs[0].utf8,r="";t.events.forEach((e=>{e.overlap=Math.max(i.tStartMs+i.dDurationMs-e.tStartMs,e.tStartMs+e.dDurationMs-i.tStartMs)})),t.events.sort(((e,t)=>e.overlap-t.overlap)),t.events.length&&0<t.events[0].overlap&&(r=t.events[0].segs[0].utf8),i.segs[0].utf8=`${s}\n${r||"\t"}`}return e}(r,o);i=a}e.respondWith(new Response(JSON.stringify(i),s))}}catch(e){console.log(e),Date.now(),await z(te)}})))}function ce(e){document.querySelectorAll(".html5-video-player").forEach((t=>{e(t)}))}window.addEventListener("message",(async function({data:e}){"initYoutubePlayer"==e.type?async function(e){Z=e.targetLang,ee=e.subSetting,ie=e.captionOnStatusByUser,await async function(){await((e,t,s)=>{var r,n;const i=null!==(r="number"==typeof t?t:null==t?void 0:t.timeout)&&void 0!==r?r:5e3,o=null!==(n="number"==typeof t?s:null==t?void 0:t.intervalBetweenAttempts)&&void 0!==n?n:50;let a=!1;const u=()=>new Promise(((t,s)=>{const r=()=>{a||new Promise(((t,s)=>{try{t(e())}catch(t){s(t)}})).then((e=>{e?t(e):U(F,o).then(r).catch(s)})).catch(s)};r()})),l=i!==V?()=>U(F,i).then((()=>{throw a=!0,new G(i)})):void 0;return null!=l?Promise.race([u(),l()]):u()})((()=>document.querySelector(".html5-video-player")),{timeout:V,intervalBetweenAttempts:1e3})}(),ue(),oe||(oe=!0,navigation.addEventListener("navigate",(e=>{se=!1,he(e.destination.url),ue()}))),he(),ve(window.location.href)||le()}(e):"pausePlayer"==e.type?async function(){1!=re&&(se=!0,ce((e=>e.pauseVideo())))}():"playPlayer"==e.type&&async function(){0!=se&&(se=!1,ce((e=>e.playVideo())))}()}),!1);const he=function(e,t,s){var r,n=s||{},i=n.noTrailing,o=void 0!==i&&i,a=n.noLeading,u=void 0!==a&&a,l=n.debounceMode,c=void 0===l?void 0:l,h=!1,d=0;function p(){r&&clearTimeout(r)}function g(){for(var s=arguments.length,n=new Array(s),i=0;i<s;i++)n[i]=arguments[i];var a=this,l=Date.now()-d;function g(){d=Date.now(),t.apply(a,n)}function f(){r=void 0}h||(u||!c||r||g(),p(),void 0===c&&l>e?u?(d=Date.now(),o||(r=setTimeout(c?f:g,e))):g():!0!==o&&(r=setTimeout(c?f:g,void 0===c?e-l:e)))}return g.cancel=function(e){var t=(e||{}).upcomingOnly,s=void 0!==t&&t;p(),h=!s},g}(1500,(async(e=window.location.href)=>{if("false"!=ie&&function(e){return ye(e)||ve(e)||e.includes("www.youtube.com/watch")}(e)){var{lang:t,translationLanguage:s}=await async function(e){var t,s=fe(e),r=await ge(s),n=r?.captions?.playerCaptionsTracklistRenderer?.captionTracks,i=n?.filter((e=>e.kind)),o=i?.[0]?.languageCode;if("targetsinglesub"==ee){var a=n?.filter((e=>e.languageCode==Z));t=(o=a?.[0]?.languageCode||o)!=Z?{languageCode:Z}:""}return{lang:o||"en",translationLanguage:t}}(e);ae=fe(e),ce((e=>e.loadModule("captions"))),function(e,t){ce((s=>{s.setOption("captions","track",{languageCode:e,translationLanguage:t})}))}(t,s),ce((e=>e.setOption("captions","reload",!0)))}}),{debounceMode:!1!==(void 0!==(de={}.atBegin)&&de)});var de;function pe(e){var t=[];for(var s of e.events)if(s.segs&&s.dDurationMs){var r=s.segs.reduce(((e,t)=>e+t.utf8),"").replace(/\s+/g," ").trim();0==t.length||t[t.length-1].tStartMs+t[t.length-1].dDurationMs<=s.tStartMs?t.push({tStartMs:s.tStartMs,dDurationMs:s.dDurationMs,segs:[{utf8:r}]}):t[t.length-1].segs[0].utf8+=r?` ${r}`:""}return{events:t,pens:[{}],wireMagic:"pb3",wpWinPositions:[{}],wsWinStyles:[{}]}}async function ge(e){var t=await fetch(`https://www.youtube.com/watch?v=${e}`),s=(await t.text()).match(/ytInitialPlayerResponse\s*=\s*({.+?})\s*;\s*(?:var\s+meta|<\/script|\n)/);return JSON.parse(s[1])}function fe(e){return ye(e)||ve(e)?e.match(/.*\/([^?]+)/)[1]:me(e,"v")}function me(e,t){return new URL(e).searchParams.get(t)}function ye(e){return e.includes("www.youtube.com/shorts")}function ve(e){return e.includes("www.youtube.com/embed")}async function be(e){var t=!1;try{var s=await fetch(we(e))}catch(e){t=!0}return(200!=s?.status||t)&&(await z(te),ne=!ne,s=await fetch(we(e))),s}function we(e){return ne?e.replace("www.youtube.com/api/timedtext","video.google.com/timedtext"):e}})();